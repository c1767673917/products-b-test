# 飞书图片下载权限申请指南

## 🚨 问题诊断结果

**错误代码**: `99991672`  
**错误类型**: 权限不足 (Access denied)  
**根本原因**: 飞书应用缺少文件下载相关权限

## 📋 需要申请的权限

为了下载多维表格中的图片文件，应用需要以下任一权限：

### 推荐权限组合：
1. **`bitable:app:readonly`** - 多维表格只读权限 ⭐
2. **`drive:drive:readonly`** - 云文档只读权限 ⭐  
3. **`docs:document.media:download`** - 文档媒体下载权限 ⭐

### 完整权限列表：
- `docs:doc` / `docs:doc:readonly`
- `drive:drive` / `drive:drive:readonly`
- `sheets:spreadsheet` / `sheets:spreadsheet:readonly`
- `vc:material` / `vc:material:readonly`
- `bitable:app` / `bitable:app:readonly`
- `moments:moments` / `moments:moments:readonly`
- `docs:document.media:download`

## 🔗 权限申请步骤

### 方法1：直接访问申请链接
```
https://open.feishu.cn/app/cli_a8fa1d87c3fad00d/auth?q=bitable:app:readonly,drive:drive:readonly,docs:document.media:download&op_from=openapi&token_type=tenant
```

### 方法2：手动申请
1. 登录飞书开放平台：https://open.feishu.cn/
2. 进入应用管理：https://open.feishu.cn/app/cli_a8fa1d87c3fad00d
3. 点击"权限管理"
4. 申请以下权限：
   - 多维表格 → `bitable:app:readonly`
   - 云文档 → `drive:drive:readonly`
   - 文档媒体 → `docs:document.media:download`

## 🛠️ 临时解决方案

在等待权限审批期间，可以考虑以下替代方案：

### 方案1：手动下载
1. 打开飞书多维表格
2. 手动下载需要的图片
3. 按照命名规则重命名文件：`编号_字段名_索引.扩展名`

### 方案2：使用浏览器插件
开发一个浏览器插件来批量下载图片（需要额外开发）

### 方案3：联系管理员
如果你不是应用的管理员，请联系应用管理员申请权限

## 📝 权限申请理由模板

```
申请理由：
为了实现产品展示系统的图片自动化管理，需要从飞书多维表格中批量下载产品图片。
这些图片将用于React前端项目的产品展示页面。

申请权限：
- bitable:app:readonly：读取多维表格数据
- drive:drive:readonly：访问云文档中的文件
- docs:document.media:download：下载文档中的媒体文件

使用场景：
- 自动同步产品图片到前端项目
- 保持产品信息的实时更新
- 提高运营效率
```

## ⚠️ 注意事项

1. **权限审批时间**：通常需要1-3个工作日
2. **最小权限原则**：只申请必要的只读权限
3. **数据安全**：确保下载的图片仅用于授权用途
4. **定期检查**：权限可能会过期，需要定期续期

## 🔍 验证权限是否生效

权限申请通过后，可以运行以下命令验证：

```bash
python3 test_image_download.py
```

如果看到 "✅ 下载成功" 的消息，说明权限已生效。

## 📞 技术支持

如果遇到问题，可以参考：
- [飞书开放平台文档](https://open.feishu.cn/document/)
- [权限错误排查指南](https://open.feishu.cn/document/uAjLw4CM/ugTN1YjL4UTN24CO1UjN/trouble-shooting/how-to-fix-the-99991672-error)
